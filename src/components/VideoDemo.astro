---
import { getTranslations } from '../i18n/translations';

const lang = Astro.currentLocale as 'en' | 'de' || 'en';
const t = getTranslations(lang).videoDemo;
---

<section class="py-20 relative overflow-hidden">
  <!-- Background decoration -->
  <div class="absolute inset-0 overflow-hidden">
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-gradient-to-br from-[#F05D23]/10 to-[#d63c6b]/10 rounded-full blur-3xl"></div>
  </div>

  <div class="container mx-auto px-6 relative z-10">
    <!-- Section Header -->
    <div class="text-center mb-12">
      <h2 class="text-3xl md:text-4xl font-bold mb-4">
        <span class="text-white">{t.title}</span>
        <span class="text-gradient-primary"> {t.titleHighlight}</span>
      </h2>
      <p class="text-[#a0a5b5] text-lg max-w-2xl mx-auto">
        {t.subtitle}
      </p>
    </div>

    <!-- Video Container -->
    <div class="max-w-4xl mx-auto">
      <div class="relative rounded-2xl overflow-hidden shadow-2xl group">
        <!-- Glow effect behind video -->
        <div class="absolute -inset-1 bg-gradient-to-r from-[#F05D23]/30 via-[#d63c6b]/30 to-[#6b4c9a]/30 rounded-2xl blur-lg opacity-60 group-hover:opacity-80 transition-opacity"></div>
        
        <!-- Video frame -->
        <!-- Video container with click-to-play -->
        <div class="relative rounded-xl overflow-hidden border border-white/20 bg-[#0d0f14] aspect-video group/video cursor-pointer" id="video-container">
          <!-- Thumbnail & Play Button (Default State) -->
          <div id="video-placeholder" class="absolute inset-0 z-10">
            <img 
              src="/assets/screenshots/the_ride.min.min.webp" 
              alt="Video Preview" 
              class="w-full h-full object-cover opacity-80 group-hover/video:opacity-100 transition-opacity duration-500"
            />
            
            <!-- Play Button Overlay -->
            <div class="absolute inset-0 flex items-center justify-center">
              <div class="w-20 h-20 flex items-center justify-center rounded-full bg-white/10 backdrop-blur-md border border-white/20 group-hover/video:scale-110 group-hover/video:bg-white/20 transition-all duration-300 shadow-2xl">
                <svg class="w-8 h-8 text-white ml-1" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M8 5v14l11-7z" />
                </svg>
              </div>
            </div>
          </div>
        
          <template id="video-template">
            <video 
              autoplay 
              loop 
              muted 
              playsinline
              class="w-full h-full object-cover"
            >
              <source src="/videos/quick_ride_selection.mp4" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          </template>
        </div>

        <script>
          const container = document.getElementById('video-container');
          const placeholder = document.getElementById('video-placeholder');
          const template = document.getElementById('video-template') as HTMLTemplateElement;

          if (container && placeholder && template) {
            const loadVideo = () => {
              // Clone the video element
              const videoContent = template.content.cloneNode(true);
              
              // Fade out placeholder
              placeholder.style.opacity = '0';
              
              // Wait for transition, then replace
              setTimeout(() => {
                placeholder.remove();
                container.appendChild(videoContent);
              }, 300); // match transition duration roughly, or just swap immediately if preferred. 
                       // actually removing it immediately is snappier for "click to play", 
                       // but let's just append and let it sit on top if z-index works, 
                       // or simpler: just clear and append.
            };

            // Simpler approach: On click, clear container and inject video
            container.addEventListener('click', () => {
              if (!container.querySelector('video')) {
                 container.innerHTML = ''; // clear placeholder
                 const videoContent = template.content.cloneNode(true);
                 container.appendChild(videoContent);
              }
            }, { once: true });
          }
        </script>
      </div>
      
      <!-- Caption -->
      <p class="text-center text-[#6b7280] text-sm mt-4 flex items-center justify-center gap-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        {t.caption}
      </p>
    </div>
  </div>
</section>
